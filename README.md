# cve-operator

The CVE Operator monitors GitHub repositories for CVE releases and processes the data, creating custom resources and jobs to handle new releases.

## Features

### GitHubReleasesMonitor

1. **CRD Definition**: Monitors releases for a specified GitHub repository.
2. **CRD Fields**:
   - **url**: URL of the GitHub repository (e.g., `https://github.com/CVEProject/cvelistV5/releases`).
   - **monitorFrom**: Specifies when to start monitoring (`now` or a specific `date`).
3. **Controller Actions**:
   - Creates a `GitHubRelease` CR if it doesn't exist.
   - Sets finalizers on `GitHubRelease` CRs.
4. **CRD Status**:
   - List of releases found on the GitHub repository.
   - Time (UTC) the information was retrieved.
   - Value of `monitorFrom` as a timestamp (UTC).

### GitHubRelease

1. **CRD Definition**: Downloads zip files with the name `delta` in them from the specified release.
2. **Controller Actions**:
   - Creates a Job to process the asset.
   - Retries failed jobs until they succeed. Once succeeded, the job will not run again for the same CRD.
3. **Deletion Handling**:
   - Recreates the `GitHubRelease` CR and reruns the job if the CR is deleted.

## Installation

To install the operator, follow these steps:

### Prerequisites

- Kubernetes cluster
- Helm installed

### Steps

1. Clone the repository:
    ```sh
    git clone https://github.com/cyse7125-su24-team09/cve-operator.git
    cd cve-operator
    ```

2. Install CRDs:
    ```sh
    kubectl apply -f config/crd/bases
    ```

3. Deploy the operator:
    ```sh
    helm install cve-operator ./helm-cve-operator-fork/ -n cve-operator
    ```

## Usage

If opting to make any changes to the API definitions, then before proceeding, generate the manifests like CRs or CRDs with
```
make manifests
```
To test out the controller, we can run it locally against the cluster. Before we do so, though, weâ€™ll need to install our CRDs, as per the quick start. This will automatically update the YAML manifests using controller-tools, if needed:

```
make install
```

Create a `GitHubReleasesMonitor` custom resource to start monitoring a repository:

```yaml
apiVersion: cve-producer.archops.com/v1
kind: GitHubReleasesMonitor
metadata:
  name: githubreleasesmonitor-sample
spec:
  url: https://github.com/CVEProject/cvelistV5/releases
  monitorFrom: "2024-07-23"
```

Apply the resource:
```sh
kubectl apply -f githubreleasesmonitor-sample.yaml
```
